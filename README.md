# Currency-Exchange-API

---
Currency Exchange API — это высокопроизводительное и масштабируемое RESTful API,
разработанное на основе современного фреймворка FastAPI.

Проект предоставляет пользователям возможность получать актуальные курсы 
обмена валют в режиме реального времени и выполнять конвертацию между различными 
валютами. Функциональные конечные точки защищены, доступ к ним предоставляется 
после безопасной регистрации пользователей с подтверждением электронной почты 
через SMTP и надежной аутентификацией с использованием JWT. 

В проекте для получения актуальных курсов валют существует интеграция с внешним 
API сервисом - [APILayer](https://apilayer.com/marketplace/currency_data-api)


## Перед стартом - обязательно!

---
0.  В корне проекта создайте файл `.env` и наполните его в предложенном формате 
    в `example.env`

## Старт на localhost - вручную

---

1. Если у вас нет виртуального окружения, то создайте и активируйте его
```shell
    python -m venv venv
```
```shell
    venv\Scripts\activate.bat
```

2. Обновите pip и установите необходимые зависимости
```shell
    python.exe -m pip install --upgrade pip
```
```shell
    pip install -r requirements.txt
```
3. Примените существующие миграции
```bash 
   alembic upgrade head
```
4. Запустите сервер
```shell
    uvicorn main:app --reload
```

## Старт на localhost - Docker:

---

1. Соберите образ 
```shell
    docker build -t currency-exchange .
```

2. Запустите контейнер из Docker образа
```shell
    docker run -p 8000:8000 currency-exchange
```


## Архитектура проекта

---

Данный проект построен с использованием современных подходов и лучших практик
разработки веб-приложений на FastAPI. Архитектура проекта разделена на несколько
слоев, что обеспечивает гибкость, масштабируемость и легкость поддержки. 

Ниже описаны основные подходы и принципы, использованные в проекте.

### Структура проекта
```
├── app/                    
│   ├── api/                # Слой API для выполнения запросов
│   │   ├── routes/         # Конечные точки
│   │   └── schemas/        # Pydentic-схемы для валидации и сериализации данных
│   │  
│   ├── core/               # Слой ядро приложения
│   │   ├── config.py       # Основная конфигурация приложения
│   │   ├── exception.py    # Вынесенные исключения
│   │   ├── log_config.py   # Настройка логирования
│   │   ├── middleware.py   # Промежуточный обработчик запросов
│   │   └── security.py     # Настройки и основные функции безопстности
│   │ 
│   ├── db/                 # Слой работы с БД
│   │   ├── alembic/        # Настройки миграций
│   │   ├── database.py     # Создание движка и получение асинхронной сессии к БД
│   │   └── models.py       # SQLalchamy модели
│   │ 
│   ├── logs/               # Логи приложения
│   ├── repositories/       # Слой для обеспечения CRUD взаимодействия с БД
│   ├── services/           # Слой сервисов (бизнесс логика)
│   ├── template/           # HTML шалбоны
│   │ 
│   └── utils/              
│       ├── external_api.py # Логика работы с внешним API
│       └── unitofwork.py   # Unit of Work для управления транзакциями.
│   
├── .env                    # Переменные среды
├── .gitignore
├── Dockerfile        
├── README.md               # Вы здесь
├── alembic.ini             # Конфигурационный файл для Alembic
├── main.py                 # Основной файл приложения
├── requirements.txt        # Зависимости-библиотеки проекта
```

### Асинхронность

Проект полностью построен на асинхронной модели работы, что позволяет 
эффективно обрабатывать множество запросов одновременно. **FastAPI**, благодаря
своей асинхронной природе, обеспечивает высокую производительность 
и отзывчивость приложения. 

### Unit of Work (UOW)

Для управления транзакциями и работы с базой данных используется паттерн 
**Unit of Work (UOW)**. Этот подход позволяет группировать операции с 
базой данных в единую транзакцию, благодаря чему обеспечивается целостность 
данных и упрощается управление сессиями. 

### Репозиторий 

Для работы с данными используются репозитории, которые выносят в отдельный слой
логику доступа к данным. Репозитории предоставляют абстракцию над базой данных
и позволяют отделить логику доступа к данным от бизнес-логики, выполняя только
**CRUD** операции.

### Сервисы

Бизнес-логика приложения вынесена в отдельный слой — **services**. 
Это позволяет отделить логику работы с данными от логики обработки запросов 
и управления состоянием приложения. Сервисы взаимодействуют с репозиториями
через **UOW** и другими компонентами, чтобы выполнять бизнес-задачи и
снять бизнес-логику из маршрутов, чем повышают уровень абстракции 
и независимости. 

### Преимущества архитектуры

- **Модульность:** 
  Каждый компонент выполняет строго определенную задачу, что упрощает 
  тестирование и поддержку.

- **Масштабируемость:** 
  Разделение на слои позволяет легко добавлять новые функции и изменять 
  существующие.

- **Гибкость:** 
  Использование паттерна UOW в связке с шаблоном репозитория, делает приложение
  адаптивным к изменениям, а также обеспечивает четкое разделение задач.

 - **Чистота кода:** 
  Это обусловлено тем, что бизнес-логика отделена от логики доступа к данным
  и маршрутов.

Такая архитектура обеспечивает надежную основу для разработки и масштабирования 
приложения, а также упрощает процесс внесения изменений и добавления новых 
функций.


## Миграции БД

---

В проекте используется **Alembic** — мощный инструмент для управления 
миграциями базы данных, который интегрирован с **PostgreSQL**. 
Alembic позволяет легко создавать, применять и откатывать изменения в структуре
базы данных. Для работы с базой данных используется **SQLAlchemy** — популярная
**ORM** библиотека **Python**, которая обеспечивает удобное взаимодействие с
реляционными БД через **ООП**.

Для работы с базой данных используется **асинхронный подход**, что обеспечивает 
высокую производительность, это позволяет эффективно обрабатывать запросы к 
базе данных без блокировки основного потока выполнения.

Подключение к БД осуществляется в связке `postgresql+asyncpg`

### Для работы с миграциями следует использовать следующие команды:

- Первый анализ изменений в БД и создание миграции

    ###### В репозитории уже есть начальные миграции (можно не использовать).
    ```bash
      alembic revision --autogenerate -m 'initial'
    ```

- Анализ изменений в БД и создание миграции
    ```bash
      alembic revision --autogenerate -m 'migration_name'
    ```

- Применение миграции (Изменение DDL в БД)
    ```bash
      alembic upgrade head
    ```

- Откатить изменения назад
    ```bash
      alembic downgrade -1
    ```


## Интеграция с внешним API

---

Этот проект интегрируется с внешним API обмена валют для получения актуальных
курсов обмена и информации о валютах в реальном времени. Использовался 
следующий внешний API:

- **API Name:** [Currency Data API](https://apilayer.com/marketplace/currency_data-api)
- **Provider:** APILayer
- **Endpoint Base URL:** `https://api.apilayer.com/currency_data`

Для использования этого API вам понадобится ключ API, который можно получить,
зарегистрировав бесплатную учетную запись 
на [сайте APILayer](https://apilayer.com/).
**Ключ API должен храниться в файле `.env`**


## Документация API

---

**FastAPI** автоматически генерирует интерактивную документацию для вашего 
**API**, это значительно упрощает процесс разработки и взаимодействия с вашим 
приложением. Документация доступна по двум стандартным путям:

 - `/docs` - Интерактивная документация в формате **Swagger UI**.

 - `/redoc` - Альтернативная документация в формате **ReDoc**.


## Обратная связь

---

Если у вас есть вопросы или вам нужна поддержка, свяжитесь со мной 
в телеграмме [@qdi2k](https://t.me/qdi2kZ)
